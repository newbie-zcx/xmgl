<!DOCTYPE html>
<html class="bg-white">
<head>
    <meta charset="utf-8">
    <title>discussisue</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="discussissue.css">
    <script src="layui/layui.js"></script>
</head>
<body>

<!-- 表格顶部操作列 -->
<script type="text/html" id="issue-toolbar">
    <span style="font-size: 20px;font-weight: bold;">最新议题</span>
    <div class="layui-btn-container" style="display: inline-block;margin-left: 40px;">
        <button id="emergency" class="normalButton">紧急</button>
        <button id="setTop" class="normalButton">置顶</button>
        <button id="hottest" class="normalButton">最热</button>
        <button id="choiceness" class="normalButton">精选</button>
    </div>
    <div class="layui-btn-container" style="display: inline-block;float: right;">
        <button class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe654;</i>新增</button>
    </div>
</script>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">
            <div class="layui-row">
                <!--  左侧表格-->
                <div class="layui-col-xs12 layui-col-md8" style="border: 1px solid #e6e6e6;background:#f2f2f2;padding: 15px 0;">
                    <div class="layui-form toolbar">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label w-auto">议题：</label>
                                <div class="layui-input-inline mr0">
                                    <input id="issues" class="layui-input" type="text" placeholder="输入关键字"/>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">提议人：</label>
                                <div class="layui-input-inline mr0">
                                    <input name="title" id="proponent" placeholder="请输入责任领导" type="text" class="layui-input"/>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">时间：</label>
                                <div class="layui-input-inline mr0">
                                    <input type="text" class="layui-input" id="timeRange" placeholder="请选择时间范围">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <button id="btnSearch" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>
                            </div>
                        </div>
                        <table class="layui-table" id="issueTable" lay-filter="issueTable"></table>
                    </div>
                </div>
                <!-- 右侧列表-->
                <div class="layui-col-xs6 layui-col-md4 rightDiv">
                    <!-- 紧急议题-->
                    <div style="height: 33%;" class="rightEmergencyIssues">
                        <div class="rightEmergencyIssuesTitle">
                            <span style="font-size: 20px;font-weight: bold;color: #F03D5E;"> <img src="images/emergency.png" alt=""> 紧急议题</span>
                            <span style="color:#454545;margin-left: 5px;">需优先处理</span>
                            <button class="layui-btn layui-btn-xs more" style="">更多></button>
                        </div>
                        <!-- 在这里循环 紧急议题 数据-->
                        <div class="rightEmergencyIssuesList" style="background: #fff;">
                            <div class="emergencyTitle">
                                <a href="#">黄河沿岸生态保护修复的方案</a>
                            </div>
                            <div class="userInformation">
                                <span><img src="images/touxiang.png" alt="" style="margin-right: 5px;">提议人：张新新</span>
                                <span style="margin-left: 20px;">12-30 15:30</span>
                                <span style="float: right;"><img src="images/yue.png" alt="" style="margin-right: 3px;">166</span>
                            </div>
                        </div>

                        <div class="rightEmergencyIssuesList" style="background: #fff;">
                            <div class="emergencyTitle">
                                <a href="#">黄河沿岸生态保护修复的方案</a>
                            </div>
                            <div class="userInformation">
                                <span><img src="images/touxiang.png" alt="" style="margin-right: 5px;">提议人：张新新</span>
                                <span style="margin-left: 20px;">12-30 15:30</span>
                                <span style="float: right;"><img src="images/yue.png" alt="" style="margin-right: 3px;">166</span>
                            </div>
                        </div>
                    </div>
                    <!--置顶议题 -->
                    <div style="height: 33%;" class="rightSetTopIssue">
                        <div class="rightSetTopIssueTitle">
                            <span style="font-size: 20px;font-weight: bold;color: #4BBC87;"> <img src="images/settop.png" alt="" style="vertical-align: text-top;"> 置顶议题</span>
                            <span style="color:#454545;margin-left: 5px;">已被置顶</span>
                            <button class="layui-btn layui-btn-xs more" style="">更多></button>
                        </div>
                        <!-- 在这里循环 置顶议题 数据-->
                        <div class="rightSetTopIssueList" style="background: #fff;">
                            <div class="setTopTitle">
                                <a href="#">黄河沿岸生态保护修复的方案</a>
                            </div>
                            <div class="userInformation">
                                <span><img src="images/touxiang.png" alt="" style="margin-right: 5px;">提议人：张新新</span>
                                <span style="margin-left: 20px;">12-30 15:30</span>
                                <span style="float: right;"><img src="images/yue.png" alt="" style="margin-right: 3px;">166</span>
                            </div>
                        </div>
                        <div class="rightSetTopIssueList" style="background: #fff;">
                            <div class="setTopTitle">
                                <a href="#">黄河沿岸生态保护修复的方案</a>
                            </div>
                            <div class="userInformation">
                                <span><img src="images/touxiang.png" alt="" style="margin-right: 5px;">提议人：张新新</span>
                                <span style="margin-left: 20px;">12-30 15:30</span>
                                <span style="float: right;"><img src="images/yue.png" alt="" style="margin-right: 3px;">166</span>
                            </div>
                        </div>
                    </div>
                    <!--最热议题 -->
                    <div style="height: 33%;" class="rightHottestIssue">
                        <div class="rightHottestIssueTitle">
                            <span style="font-size: 20px;font-weight: bold;color: #4BBC87;"> <img src="images/settop.png" alt="" style="vertical-align: text-top;"> 最热议题</span>
                            <span style="color:#454545;margin-left: 5px;">已成为最热</span>
                            <button class="layui-btn layui-btn-xs more" style="">更多></button>
                        </div>
                        <!-- 在这个 div 循环 最热议题 数据-->
                        <div class="rightHottestIssueList" style="background: #fff;">
                            <div class="hottestTitle">
                                <a href="#">黄河沿岸生态保护修复的方案</a>
                            </div>
                            <div class="userInformation">
                                <span><img src="images/touxiang.png" alt="" style="margin-right: 5px;">提议人：张新新</span>
                                <span style="margin-left: 20px;">12-30 15:30</span>
                                <span style="float: right;"><img src="images/yue.png" alt="" style="margin-right: 3px;">166</span>
                            </div>
                        </div>
                        <div class="rightHottestIssueList" style="background: #fff;">
                            <div class="hottestTitle">
                                <a href="#">黄河沿岸生态保护修复的方案</a>
                            </div>
                            <div class="userInformation">
                                <span><img src="images/touxiang.png" alt="" style="margin-right: 5px;">提议人：张新新</span>
                                <span style="margin-left: 20px;">12-30 15:30</span>
                                <span style="float: right;"><img src="images/yue.png" alt="" style="margin-right: 3px;">166</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 表格操作列 -->
    <script type="text/html" id="tableBar">
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="view">查看</a>
        <%if(shiro.hasPermission("issue:update")){ %>
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>
        <% } %>
        <%if(shiro.hasPermission("issue:delete")){ %>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        <% } %>
        <!--<a class="layui-btn layui-btn-xs" lay-event="auth">权限分配</a>-->
    </script>

    <!-- js部分 -->
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script>
        layui.use(['layer', 'form', 'table', 'util','element','laydate'], function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            var form = layui.form;
            var table = layui.table;
            var util = layui.util;
            var element = layui.element;
            var laydate = layui.laydate;

            laydate.render({
                elem: '#timeRange'
                ,range: true
            });

            //渲染表格
            table.render({
                elem: '#issueTable',
                title:"",
                url: '/discuss/issue/list',
                toolbar: '#issue-toolbar',
                defaultToolbar: false,
                where: $('form').serialize(),
                page: true,
                cols: [[
                    {type: 'checkbox'},
                    {type: 'numbers', title:'序号'},
                    {title: '议题', field: 'title', align: 'center', valign: 'middle'},
                    {title: '发起人', field: 'content', align: 'center', valign: 'middle'},
                    {title: '提议时间', field: 'issueType', align: 'center', valign: 'middle'},
                    {align: 'center', toolbar: '#tableBar', title: '操作'}
                ]]
            });
            //渲染表格
            table.render({
                elem: '#demo',
                title:"",
                url: '/discuss/issue/list',
                toolbar: '',
                where: $('form').serialize(),
                page: true,
                cols: [[
                    {type: 'numbers', title:'序号'},
                    {type: 'checkbox'},
                    {title: '标题', field: 'title', align: 'center', valign: 'middle', sort: true},
                    {title: '内容', field: 'content', align: 'center', valign: 'middle', sort: true},
                    {title: '类型', field: 'issueType', align: 'center', valign: 'middle', sort: true},
                    {title: '创建人姓名', field: 'createName', align: 'center', valign: 'middle', sort: true},
                    {title: '创建时间', field: 'createDate', align: 'center', valign: 'middle', sort: true},

                    {align: 'center', toolbar: '#tableBar', title: '操作'}

                ]]
            });
            /头工具栏事件
            table.on('toolbar(issueTable)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                switch(obj.event){
                    case 'add':
                        showAddModel();
                        break;
                    case 'del':
                        if (checkStatus.data.length == 0) {
                            layer.msg('请选择要删除的数据', {icon: 2});
                        } else {
                            var data = checkStatus.data;
                            var id_str="";
                            for (var i=0;i<data.length;i++){
                                id_str +=data[i].id+",";
                            }
                            id_str = id_str.substr(0, id_str.length-1);
                            layer.confirm('真的删除么', function(index){
                                layer.load(2);
                                $.post('issue/batchDelete', {
                                    departIds: id_str
                                }, function (data) {
                                    layer.closeAll('loading');
                                    if (data.code == 200) {
                                        layer.msg(data.msg, {icon: 1});
                                        obj.del();
                                        // table.reload('Table');
                                    } else {
                                        layer.msg(data.msg, {icon: 2});
                                    }
                                });
                            });
                        }
                        break;
                    case 'export':
                        if (checkStatus.data.length == 0) {
                            layer.msg('请选择要导出的数据', {icon: 2});
                        } else {
                            table.exportFile(ins1.config.id, checkStatus.data, 'xls');
                        }
                        break;
                };
            });



            // 删除
            function doDelete(obj) {
                top.layer.confirm('确定要删除吗？', function (index) {
                    top.layer.close(index);
                    layer.load(2);
                    $.post('issue/delete', {
                        issueId: obj.data.id
                    }, function (data) {
                        layer.closeAll('loading');
                        if (data.code == 200) {
                            layer.msg(data.msg, {icon: 1});
                            obj.del();
                        } else {
                            layer.msg(data.msg, {icon: 2});
                        }
                    });
                });
            }

            // 显示编辑弹窗
            function showEditModel(data) {
                admin.putTempData('t_issue', data);
                admin.putTempData('formOk', false);
                top.layui.admin.open({
                    type: 2,
                    title: '修改',
                    area: ['350px', '380px'],
                    content: '/discuss/issue/issueupdate',
                    end: function () {
                        admin.getTempData('formOk') && table.reload('Table');  // 成功刷新表格
                    }
                });
            }

            // 显示编辑弹窗
            function showAddModel(data) {
                top.layui.admin.open({
                    type: 2,
                    title: '添加',
                    area: ['650px', '880px'],
                    content: '/discuss/issue/issueadd',
                    end: function () {
                        admin.getTempData('formOk') && table.reload('roleTable');  // 成功刷新表格
                    }
                });
            }

            // 查看
            function showViewModel(issueId) {
                top.layui.admin.open({
                    type: 2,
                    title: '查看',
                    area: ['650px', '880px'],
                    content: 'issue/detail/' + issueId
                });
            }
            // 搜索按钮点击事件
            $('#btnSearch').click(function () {
                table.reload('roleTable', {where: $('form').serialize()});
            });

            // 工具条点击事件
            table.on('tool(issueTable)', function (obj) {
                var data = obj.data;
                if (obj.event === 'edit') { //修改
                    showEditModel(data);
                } else if (obj.event === 'del') { //删除
                    doDelete(obj);
                } else if (obj.event === 'view') {  //查看
                    showViewModel(obj.data.id);
                }
            });

        });
    </script>

</body>
</html>